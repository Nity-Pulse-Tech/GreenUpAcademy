{% extends 'publics/home/base.html' %}
{% load static %}
{% load i18n %}

    <script src="{% static 'js/common/toast_manager.js' %}"></script>
    <script src="{% static 'js/common/loader_manager.js' %}"></script>

{% block content %}
    <style>
        :root {
            --primary: #22c55e; /* Assuming primary-green is a shade of green */
            --primary-dark: #15803d;
        }

        .admission-step {
            transition: all 0.3s ease;
        }
        .admission-step:hover {
            transform: translateY(-5px);
        }
        .form-section {
            transition: all 0.3s ease;
        }
        .form-section:hover {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .program-option {
            transition: all 0.2s ease;
        }
        .program-option:hover {
            background-color: #f0f9f0;
        }

        .wizard-step {
            display: none;
        }
        .wizard-step.active {
            display: block;
        }
        .progress-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
        }
        .progress-step {
            flex: 1;
            text-align: center;
            position: relative;
            padding-bottom: 0.5rem;
        }
        .progress-step.active .progress-circle {
            background: var(--primary);
            color: white;
        }
        .progress-step.completed .progress-circle {
            background: var(--primary);
            color: white;
        }
        .progress-circle {
            width: 2rem;
            height: 2rem;
            background: #e5e7eb;
            color: #6b7280;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        .progress-step:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 1rem;
            left: 50%;
            width: calc(100% - 2rem);
            height: 4px;
            background: #e5e7eb;
            z-index: -1;
        }
        .progress-step.active:not(:last-child)::after,
        .progress-step.completed:not(:last-child)::after {
            background: var(--primary);
        }
        .form-checkbox, .form-radio {
            appearance: none;
            width: 1.25rem;
            height: 1.25rem;
            border: 2px solid #6b7280;
            border-radius: 4px;
            cursor: pointer;
        }
        .form-checkbox:checked, .form-radio:checked {
            background-color: var(--primary);
            border-color: var(--primary);
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='white'%3E%3Cpath fill-rule='evenodd' d='M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z' clip-rule='evenodd'/%3E%3C/svg%3E");
            background-size: 0.75rem;
            background-position: center;
            background-repeat: no-repeat;
        }
        .form-radio {
            border-radius: 50%;
        }
        .form-checkbox:focus, .form-radio:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.3);
        }
        .review-section {
            background: #f9fafb;
            padding: 1rem;
            border-radius: 8px;
        }
    </style>

    <!-- Breadcrumb Section -->
    <section class="bg-primary-green text-white py-6">
        <div class="container mx-auto px-4">
            <div class="text-center">
                <h1 class="text-3xl font-bold mb-2">{% trans "Admission - Étudiants UE" %}</h1>
                <p class="text-lg">Green Up Academy > Admission > Union Européenne</p>
            </div>
        </div>
    </section>

    <!-- Main Content Section -->
    <main class="py-12">
        <div class="container mx-auto px-4 max-w-4xl">
            <!-- Introduction -->
            <div class="bg-white rounded-lg shadow-lg p-8 mb-12 text-center">
                <h2 class="text-2xl font-bold text-primary mb-4">{% trans "FORMULAIRE D'ADMISSION – ÉTUDIANTS DE L'UNION EUROPÉENNE" %}</h2>
                <p class="text-gray-600 mb-6">GREEN UP ACADEMY – PARIS / REIMS</p>
                <div class="bg-blue-50 p-4 rounded-lg border border-blue-200 inline-flex items-center">
                    <i class="fas fa-envelope text-blue-500 text-xl mr-3"></i>
                    <p class="text-blue-700">{% trans "Envoyez votre dossier complet à :" %} <span class="font-semibold">contact@green-up-academy.com</span></p>
                </div>
            </div>

            <!-- Admission Process Steps -->
            <section class="mb-16">
                <h2 class="text-3xl font-bold text-center mb-12">{% trans "PROCÉDURE D'ADMISSION" %}</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="bg-white rounded-lg shadow-lg p-6 admission-step">
                        <div class="flex items-center mb-4">
                            <div class="bg-primary-green text-white rounded-full w-10 h-10 flex items-center justify-center text-xl font-bold mr-3">1</div>
                            <h3 class="text-xl font-semibold">{% trans "Envoi du Dossier" %}</h3>
                        </div>
                        <p class="text-gray-600">{% trans "Transmettez par email les documents demandés (voir section 'Documents à fournir')." %}</p>
                    </div>
                    <div class="bg-white rounded-lg shadow-lg p-6 admission-step">
                        <div class="flex items-center mb-4">
                            <div class="bg-primary-green text-white rounded-full w-10 h-10 flex items-center justify-center text-xl font-bold mr-3">2</div>
                            <h3 class="text-xl font-semibold">{% trans "Entretien Individuel" %}</h3>
                        </div>
                        <p class="text-gray-600 mb-2">{% trans "Chaque candidat admis est reçu en entretien :" %}</p>
                        <ul class="list-disc list-inside text-gray-600 space-y-1 pl-4">
                            <li>{% trans "En présentiel (sur le campus sélectionné)" %}</li>
                            <li>{% trans "À distance (visioconférence)" %}</li>
                        </ul>
                        <p class="text-gray-600 mt-3">{% trans "Cet échange permet d'évaluer votre motivation, vos objectifs professionnels et l'adéquation avec la formation." %}</p>
                    </div>
                    <div class="bg-white rounded-lg shadow-lg p-6 admission-step">
                        <div class="flex items-center mb-4">
                            <div class="bg-primary-green text-white rounded-full w-10 h-10 flex items-center justify-center text-xl font-bold mr-3">3</div>
                            <h3 class="text-xl font-semibold">{% trans "Admission & Inscription" %}</h3>
                        </div>
                        <p class="text-gray-600 mb-3">{% trans "Si votre candidature est retenue, vous recevrez une confirmation d'admission." %}</p>
                        <p class="text-gray-600 mb-3">{% trans "L'inscription sera validée après règlement des frais suivants :" %}</p>
                        <p class="text-primary font-semibold mb-4">{% trans "Frais d'inscription : 1 200 €" %}</p>
                        <div class="bg-green-50 p-3 rounded-lg border border-green-200">
                            <p class="text-green-700 text-sm font-semibold">{% trans "Cas particulier - Alternance :" %}</p>
                            <p class="text-green-700 text-sm">{% trans "• Les frais d'inscription ne sont pas dus si un contrat d'alternance est signé avant la rentrée." %}</p>
                            <p class="text-green-700 text-sm">{% trans "• Si le contrat est signé en cours d'année, les 1 200 € sont intégralement remboursés." %}</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Application Form -->
            <section class="bg-white rounded-lg shadow-lg p-8 mb-16" id="admission-section">
                <h2 class="text-3xl font-bold mb-8 text-center">{% trans "Formulaire d'Admission" %}</h2>

               <!-- Progress Bar -->
<div class="progress-bar flex flex-wrap justify-between gap-4 md:gap-6 lg:gap-8">
    <div class="progress-step active flex flex-col items-center w-1/2 sm:w-1/3 md:w-auto" data-step="1">
        <div class="progress-circle">1</div>
        <div class="text-xs sm:text-sm font-medium text-center">{% trans "Personal Information" %}</div>
    </div>
    <div class="progress-step flex flex-col items-center w-1/2 sm:w-1/3 md:w-auto" data-step="2">
        <div class="progress-circle">2</div>
        <div class="text-xs sm:text-sm font-medium text-center">{% trans "Contact Information" %}</div>
    </div>
    <div class="progress-step flex flex-col items-center w-1/2 sm:w-1/3 md:w-auto" data-step="3">
        <div class="progress-circle">3</div>
        <div class="text-xs sm:text-sm font-medium text-center">{% trans "Academic Background" %}</div>
    </div>
    <div class="progress-step flex flex-col items-center w-1/2 sm:w-1/3 md:w-auto" data-step="4">
        <div class="progress-circle">4</div>
        <div class="text-xs sm:text-sm font-medium text-center">{% trans "Campus & Program" %}</div>
    </div>
    <div class="progress-step flex flex-col items-center w-1/2 sm:w-1/3 md:w-auto" data-step="5">
        <div class="progress-circle">5</div>
        <div class="text-xs sm:text-sm font-medium text-center">{% trans "Documents & Declaration" %}</div>
    </div>
    <div class="progress-step flex flex-col items-center w-1/2 sm:w-1/3 md:w-auto" data-step="6">
        <div class="progress-circle">6</div>
        <div class="text-xs sm:text-sm font-medium text-center">{% trans "Review & Submit" %}</div>
    </div>
</div>


                <form id="admission-form" enctype="multipart/form-data" class="space-y-8">
                    {% csrf_token %}

                    <!-- Step 1: Personal Information -->
                    <div class="wizard-step active" data-step="1">
                        <div class="form-section p-6 border border-gray-200 rounded-lg">
                            <h3 class="text-xl font-semibold mb-6 text-primary">{% trans "INFORMATIONS PERSONNELLES" %}</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-gray-700 mb-2">{% trans "Nom" %} <span class="text-red-500">*</span></label>
                                    <input type="text" name="last_name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-primary" required>
                                    <div id="last_name-error" class="text-red-500 text-sm mt-1 hidden"></div>
                                </div>
                                <div>
                                    <label class="block text-gray-700 mb-2">{% trans "Prénom" %} <span class="text-red-500">*</span></label>
                                    <input type="text" name="first_name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-primary" required>
                                    <div id="first_name-error" class="text-red-500 text-sm mt-1 hidden"></div>
                                </div>
                                <div>
                                    <label class="block text-gray-700 mb-2">{% trans "Date de naissance" %} <span class="text-red-500">*</span></label>
                                    <input type="date" name="date_of_birth" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-primary" required>
                                    <div id="date_of_birth-error" class="text-red-500 text-sm mt-1 hidden"></div>
                                </div>
                                <div>
                                    <label class="block text-gray-700 mb-2">{% trans "Téléphone mobile" %} <span class="text-red-500">*</span></label>
                                    <input type="tel" name="phone_number" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-primary" required>
                                    <div id="phone_number-error" class="text-red-500 text-sm mt-1 hidden"></div>
                                </div>
                                <div class="md:col-span-2">
                                    <label class="block text-gray-700 mb-2">{% trans "E-mail" %} <span class="text-red-500">*</span></label>
                                    <input type="email" name="email" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-primary" required>
                                    <div id="email-error" class="text-red-500 text-sm mt-1 hidden"></div>
                                </div>
                            </div>
                        </div>
                        <div class="flex justify-end mt-6">
                            <button type="button" class="bg-primary-green text-white font-semibold py-3 px-8 rounded-lg transition-colors next-step">{% trans "Next" %} <i class="fas fa-arrow-right ml-2"></i></button>
                        </div>
                    </div>

                    <!-- Step 2: Contact Information -->
                    <div class="wizard-step" data-step="2">
                        <div class="form-section p-6 border border-gray-200 rounded-lg">
                            <h3 class="text-xl font-semibold mb-6 text-primary">{% trans "COORDONNÉES" %}</h3>
                            <div class="grid grid-cols-1 gap-6">
                                <div>
                                    <label class="block text-gray-700 mb-2">{% trans "Adresse complète" %} <span class="text-red-500">*</span></label>
                                    <input type="text" name="address" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-primary" required>
                                    <div id="address-error" class="text-red-500 text-sm mt-1 hidden"></div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <div>
                                        <label class="block text-gray-700 mb-2">{% trans "Code postal" %} <span class="text-red-500">*</span></label>
                                        <input type="text" name="zip_code" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-primary" required>
                                        <div id="zip_code-error" class="text-red-500 text-sm mt-1 hidden"></div>
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 mb-2">{% trans "Ville" %} <span class="text-red-500">*</span></label>
                                        <input type="text" name="city" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-primary" required>
                                        <div id="city-error" class="text-red-500 text-sm mt-1 hidden"></div>
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 mb-2">{% trans "Pays" %} <span class="text-red-500">*</span></label>
                                        <input type="text" name="country" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-primary" required>
                                        <div id="country-error" class="text-red-500 text-sm mt-1 hidden"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="flex justify-between mt-6">
                            <button type="button" class="bg-primary-green text-white font-semibold py-3 px-8 rounded-lg transition-colors prev-step"><i class="fas fa-arrow-left mr-2"></i> {% trans "Previous" %}</button>
                            <button type="button" class="bg-primary-green text-white font-semibold py-3 px-8 rounded-lg transition-colors next-step">{% trans "Next" %} <i class="fas fa-arrow-right ml-2"></i></button>
                        </div>
                    </div>

                    <!-- Step 3: Academic Background -->
                    <div class="wizard-step" data-step="3">
                        <div class="form-section p-6 border border-gray-200 rounded-lg">
                            <h3 class="text-xl font-semibold mb-6 text-primary">{% trans "PARCOURS ACADÉMIQUE" %}</h3>
                            <div class="grid grid-cols-1 gap-6">
                                <div>
                                    <label class="block text-gray-700 mb-2">{% trans "Dernier diplôme obtenu ou en cours" %} <span class="text-red-500">*</span></label>
                                    <input type="text" name="last_diploma" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-primary" required>
                                    <div id="last_diploma-error" class="text-red-500 text-sm mt-1 hidden"></div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-gray-700 mb-2">{% trans "Établissement" %} <span class="text-red-500">*</span></label>
                                        <input type="text" name="institution" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-primary" required>
                                        <div id="institution-error" class="text-red-500 text-sm mt-1 hidden"></div>
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 mb-2">{% trans "Ville / Pays" %} <span class="text-red-500">*</span></label>
                                        <input type="text" name="institution_city_country" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-primary" required>
                                        <div id="institution_city_country-error" class="text-red-500 text-sm mt-1 hidden"></div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-gray-700 mb-2">{% trans "Année d'obtention (prévue ou effective)" %} <span class="text-red-500">*</span></label>
                                    <input type="text" name="year_obtained" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-primary" required>
                                    <div id="year_obtained-error" class="text-red-500 text-sm mt-1 hidden"></div>
                                </div>
                            </div>
                            <div class="bg-blue-50 p-4 rounded-lg border border-blue-200 mt-4 flex items-start">
                                <i class="fas fa-info-circle text-blue-500 text-xl mr-3 mt-1"></i>
                                <p class="text-blue-700">{% trans "Les diplômes obtenus dans l'Union Européenne ne nécessitent pas de certification officielle." %}</p>
                            </div>
                        </div>
                        <div class="flex justify-between mt-6">
                            <button type="button" class="bg-primary-green text-white font-semibold py-3 px-8 rounded-lg transition-colors prev-step"><i class="fas fa-arrow-left mr-2"></i> {% trans "Previous" %}</button>
                            <button type="button" class="bg-primary-green text-white font-semibold py-3 px-8 rounded-lg transition-colors next-step">{% trans "Next" %} <i class="fas fa-arrow-right ml-2"></i></button>
                        </div>
                    </div>

                    <!-- Step 4: Campus and Program Selection -->
                    <div class="wizard-step" data-step="4">
                        <div class="form-section p-6 border border-gray-200 rounded-lg">
                            <h3 class="text-xl font-semibold mb-6 text-primary">{% trans "CHOIX DU CAMPUS ET DE LA FORMATION" %}</h3>
                            <div class="mb-8">
                                <h4 class="text-lg font-semibold mb-4">1. {% trans "Campus souhaité :" %}</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    {% for campus in campuses %}
                                        <label class="program-option flex items-center p-4 border border-gray-300 rounded-lg cursor-pointer">
                                            <input type="radio" name="campus" value="{{ campus.name }}" class="form-radio text-primary h-5 w-5" required>
                                            <span class="ml-3 text-gray-700">{{ campus.name }}</span>
                                        </label>
                                    {% empty %}
                                        <p class="text-red-500">{% trans "No campuses available. Please contact support." %}</p>
                                    {% endfor %}
                                </div>
                                <div id="campus-error" class="text-red-500 text-sm mt-1 hidden"></div>
                            </div>
                            <div class="mb-8">
                                <h4 class="text-lg font-semibold mb-4">2. {% trans "Formation choisie :" %}</h4>
                                <h5 class="font-semibold text-primary mb-3">{% trans "Bachelors (Bac +3)" %}</h5>
                                <div class="grid grid-cols-1 gap-3 mb-6">
                                    {% for program in bachelor_programs %}
                                        <label class="program-option flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer">
                                            <input type="radio" name="program" value="{{ program.name }}" class="form-radio text-primary h-5 w-5" required>
                                            <span class="ml-3 text-gray-700">{{ program.name }}</span>
                                        </label>
                                    {% empty %}
                                        <p class="text-red-500">{% trans "No Bachelor programs available." %}</p>
                                    {% endfor %}
                                </div>
                                <h5 class="font-semibold text-primary mb-3">{% trans "Mastères (Bac +5)" %}</h5>
                                <div class="grid grid-cols-1 gap-3">
                                    {% for program in master_programs %}
                                        <label class="program-option flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer">
                                            <input type="radio" name="program" value="{{ program.name }}" class="form-radio text-primary h-5 w-5">
                                            <span class="ml-3 text-gray-700">{{ program.name }}</span>
                                        </label>
                                    {% empty %}
                                        <p class="text-red-500">{% trans "No Master programs available." %}</p>
                                    {% endfor %}
                                </div>
                                <div id="program-error" class="text-red-500 text-sm mt-1 hidden"></div>
                            </div>
                            <div>
                                <h4 class="text-lg font-semibold mb-4">{% trans "Avez-vous déjà une alternance pour votre formation ?" %}</h4>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    {% for value, label in apprenticeship_choices %}
                                        <label class="program-option flex items-center p-4 border border-gray-300 rounded-lg cursor-pointer">
                                            <input type="radio" name="apprenticeship" value="{{ value }}" class="form-radio text-primary h-5 w-5" {% if value == "undecided" %}required{% endif %}>
                                            <span class="ml-3 text-gray-700">{{ label }}</span>
                                        </label>
                                    {% endfor %}
                                </div>
                                <div id="apprenticeship-error" class="text-red-500 text-sm mt-1 hidden"></div>
                            </div>
                        </div>
                        <div class="flex justify-between mt-6">
                            <button type="button" class="bg-primary-green text-white font-semibold py-3 px-8 rounded-lg transition-colors prev-step"><i class="fas fa-arrow-left mr-2"></i> {% trans "Previous" %}</button>
                            <button type="button" class="bg-primary-green text-white font-semibold py-3 px-8 rounded-lg transition-colors next-step">{% trans "Next" %} <i class="fas fa-arrow-right ml-2"></i></button>
                        </div>
                    </div>

                    <!-- Step 5: Required Documents & Declaration -->
                    <div class="wizard-step" data-step="5">
                        <div class="form-section mb-8 p-6 border border-gray-200 rounded-lg">
                            <h3 class="text-xl font-semibold mb-6 text-primary">{% trans "DOCUMENTS À FOURNIR" %}</h3>
                            <p class="text-gray-600 mb-4">
                                {% trans "Veuillez téléverser les documents suivants (formats acceptés :" %} <span class="font-semibold text-primary">{% trans "PDF / JPEG" %}</span>) :
                            </p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-gray-700 font-medium mb-1">{% trans "CV" %} <span class="text-red-500">*</span></label>
                                    <input type="file" name="cv" accept=".pdf,.jpeg,.jpg,.png" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-primary-green focus:outline-none" required>
                                    <div id="cv-error" class="text-red-500 text-sm mt-1 hidden"></div>
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-1">{% trans "Lettre de motivation" %} <span class="text-red-500">*</span></label>
                                    <input type="file" name="lettre_motivation" accept=".pdf,.jpeg,.jpg,.png" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-primary-green focus:outline-none" required>
                                    <div id="lettre_motivation-error" class="text-red-500 text-sm mt-1 hidden"></div>
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-1">{% trans "Relevés de notes / Attestation d'études" %} <span class="text-red-500">*</span></label>
                                    <input type="file" name="releves_notes" accept=".pdf,.jpeg,.jpg,.png" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-primary-green focus:outline-none" required>
                                    <div id="releves_notes-error" class="text-red-500 text-sm mt-1 hidden"></div>
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-1">{% trans "Pièce d'identité (CNI / Passeport)" %} <span class="text-red-500">*</span></label>
                                    <input type="file" name="piece_identite" accept=".pdf,.jpeg,.jpg,.png" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-primary-green focus:outline-none" required>
                                    <div id="piece_identite-error" class="text-red-500 text-sm mt-1 hidden"></div>
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-1">{% trans "Photo d'identité" %} <span class="text-red-500">*</span></label>
                                    <input type="file" name="photo_identite" accept=".jpeg,.jpg,.png" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-primary-green focus:outline-none" required>
                                    <div id="photo_identite-error" class="text-red-500 text-sm mt-1 hidden"></div>
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-1">{% trans "Portfolio (optionnel)" %}</label>
                                    <input type="file" name="portfolio" accept=".pdf,.jpeg,.jpg,.png" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-primary-green focus:outline-none">
                                    <div id="portfolio-error" class="text-red-500 text-sm mt-1 hidden"></div>
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-1">{% trans "Signature (manuscrite ou numérique)" %} <span class="text-red-500">*</span></label>
                                    <input type="file" name="signature" accept=".pdf,.jpeg,.jpg,.png" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-primary-green focus:outline-none" required>
                                    <div id="signature-error" class="text-red-500 text-sm mt-1 hidden"></div>
                                </div>
                            </div>
                        </div>
                        <div class="form-section mb-8 p-6 border border-gray-200 rounded-lg">
                            <h3 class="text-xl font-semibold mb-6 text-primary">{% trans "COMMENT AVEZ-VOUS CONNU GREEN UP ACADEMY ?" %}</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="how_heard_internet" class="form-checkbox text-primary">
                                        <span class="ml-2">{% trans "Internet" %}</span>
                                    </label>
                                </div>
                                <div>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="how_heard_social_media" class="form-checkbox text-primary">
                                        <span class="ml-2">{% trans "Réseaux sociaux" %}</span>
                                    </label>
                                </div>
                                <div>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="how_heard_forum_check" class="form-checkbox text-primary">
                                        <span class="ml-2">{% trans "Forum / Salon (précisez) :" %}</span>
                                    </label>
                                    <input type="text" name="how_heard_forum" class="w-full mt-2 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-primary">
                                </div>
                                <div>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="how_heard_student_alumni" class="form-checkbox text-primary">
                                        <span class="ml-2">{% trans "Étudiant ou alumni" %}</span>
                                    </label>
                                </div>
                                <div>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="how_heard_other_check" class="form-checkbox text-primary">
                                        <span class="ml-2">{% trans "Autre :" %}</span>
                                    </label>
                                    <input type="text" name="how_heard_other" class="w-full mt-2 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-primary">
                                </div>
                            </div>
                        </div>
                        <div class="form-section mb-8 p-6 border border-gray-200 rounded-lg bg-green-50 border-green-200">
                            <h3 class="text-xl font-semibold mb-6 text-primary">{% trans "FRAIS D'INSCRIPTION" %}</h3>
                            <div class="flex items-center mb-4">
                                <div class="bg-primary-green text-white rounded-full w-12 h-12 flex items-center justify-center text-xl font-bold mr-4">
                                    €
                                </div>
                                <div>
                                    <p class="text-2xl font-bold text-primary">{% trans "1 200 € TTC" %}</p>
                                    <p class="text-gray-600">{% trans "Montant dû une fois admis·e" %}</p>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
                                <div class="bg-white p-4 rounded-lg border border-green-200">
                                    <div class="flex items-center mb-2">
                                        <i class="fas fa-check-circle text-green-500 mr-2"></i>
                                        <p class="font-semibold">{% trans "Gratuit" %}</p>
                                    </div>
                                    <p class="text-sm text-gray-600">{% trans "si contrat d'alternance signé avant la rentrée" %}</p>
                                </div>
                                <div class="bg-white p-4 rounded-lg border border-green-200">
                                    <div class="flex items-center mb-2">
                                        <i class="fas fa-exchange-alt text-green-500 mr-2"></i>
                                        <p class="font-semibold">{% trans "Remboursé intégralement" %}</p>
                                    </div>
                                    <p class="text-sm text-gray-600">{% trans "si alternance obtenue après inscription" %}</p>
                                </div>
                            </div>
                        </div>
                        <div class="form-section mb-8 p-6 border border-gray-200 rounded-lg bg-gray-50">
                            <h3 class="text-xl font-semibold mb-6 text-primary">{% trans "DÉCLARATION" %}</h3>
                            <div class="space-y-4 text-gray-600 mb-6">
                                <p>{% trans "Je certifie que les informations fournies dans ce formulaire sont exactes." %}</p>
                                <p>{% trans "Je comprends qu'un entretien est obligatoire avant admission." %}</p>
                                <p>{% trans "Je suis informé·e que les frais d'inscription ne s'appliquent pas si je suis en alternance et sont remboursables en cas de signature de contrat en cours d'année." %}</p>
                                <label class="flex items-center">
                                    <input type="checkbox" name="declaration_accepted" class="form-checkbox text-primary" required>
                                    <span class="ml-2">{% trans "J'accepte la déclaration ci-dessus" %}</span>
                                </label>
                                <div id="declaration_accepted-error" class="text-red-500 text-sm mt-1 hidden"></div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <div>
                                    <label class="block text-gray-700 mb-2">{% trans "Fait à" %} <span class="text-red-500">*</span></label>
                                    <input type="text" name="declaration_place" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-primary" required>
                                    <div id="declaration_place-error" class="text-red-500 text-sm mt-1 hidden"></div>
                                </div>
                                <div>
                                    <label class="block text-gray-700 mb-2">{% trans "Le" %} <span class="text-red-500">*</span></label>
                                    <input type="date" name="declaration_date" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-primary" required>
                                    <div id="declaration_date-error" class="text-red-500 text-sm mt-1 hidden"></div>
                                </div>
                            </div>
                        </div>
                        <div class="flex justify-between mt-6">
                            <button type="button" class="bg-primary-green text-white font-semibold py-3 px-8 rounded-lg transition-colors prev-step"><i class="fas fa-arrow-left mr-2"></i> {% trans "Previous" %}</button>
                            <button type="button" class="bg-primary-green text-white font-semibold py-3 px-8 rounded-lg transition-colors next-step">{% trans "Next" %} <i class="fas fa-arrow-right ml-2"></i></button>
                        </div>
                    </div>

                   <!-- Étape 6 : Vérification & Soumission -->
<div class="wizard-step" data-step="6">
    <div class="form-section p-8 bg-white border border-gray-200 rounded-2xl shadow-sm">
        <!-- Titre -->
        <h3 class="text-2xl font-bold mb-8 text-primary flex items-center">
            <i class="fas fa-check-circle text-primary mr-3"></i> {% trans "Vérification & Soumission" %}
        </h3>

        <div class="review-section grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- Informations personnelles -->
            <div class="p-6 bg-gray-50 rounded-xl shadow-sm border">
                <h4 class="text-lg font-semibold mb-4 text-gray-800 flex items-center">
                    <i class="fas fa-user text-primary mr-2"></i> {% trans "Informations personnelles" %}
                </h4>
                <div class="space-y-2 text-sm text-gray-700">
                    <p><strong>{% trans "Nom" %} :</strong> <span id="review-last_name"></span></p>
                    <p><strong>{% trans "Prénom" %} :</strong> <span id="review-first_name"></span></p>
                    <p><strong>{% trans "Date de naissance" %} :</strong> <span id="review-date_of_birth"></span></p>
                    <p><strong>{% trans "Téléphone mobile" %} :</strong> <span id="review-phone_number"></span></p>
                    <p><strong>{% trans "E-mail" %} :</strong> <span id="review-email"></span></p>
                </div>
            </div>

            <!-- Coordonnées -->
            <div class="p-6 bg-gray-50 rounded-xl shadow-sm border">
                <h4 class="text-lg font-semibold mb-4 text-gray-800 flex items-center">
                    <i class="fas fa-map-marker-alt text-primary mr-2"></i> {% trans "Coordonnées" %}
                </h4>
                <div class="space-y-2 text-sm text-gray-700">
                    <p><strong>{% trans "Adresse complète" %} :</strong> <span id="review-address"></span></p>
                    <p><strong>{% trans "Code postal" %} :</strong> <span id="review-zip_code"></span></p>
                    <p><strong>{% trans "Ville" %} :</strong> <span id="review-city"></span></p>
                    <p><strong>{% trans "Pays" %} :</strong> <span id="review-country"></span></p>
                </div>
            </div>

            <!-- Parcours académique -->
            <div class="p-6 bg-gray-50 rounded-xl shadow-sm border">
                <h4 class="text-lg font-semibold mb-4 text-gray-800 flex items-center">
                    <i class="fas fa-graduation-cap text-primary mr-2"></i> {% trans "Parcours académique" %}
                </h4>
                <div class="space-y-2 text-sm text-gray-700">
                    <p><strong>{% trans "Dernier diplôme obtenu ou en cours" %} :</strong> <span id="review-last_diploma"></span></p>
                    <p><strong>{% trans "Établissement" %} :</strong> <span id="review-institution"></span></p>
                    <p><strong>{% trans "Ville / Pays" %} :</strong> <span id="review-institution_city_country"></span></p>
                    <p><strong>{% trans "Année d'obtention" %} :</strong> <span id="review-year_obtained"></span></p>
                </div>
            </div>

            <!-- Campus & Programme -->
            <div class="p-6 bg-gray-50 rounded-xl shadow-sm border">
                <h4 class="text-lg font-semibold mb-4 text-gray-800 flex items-center">
                    <i class="fas fa-book-open text-primary mr-2"></i> {% trans "Campus & Programme" %}
                </h4>
                <div class="space-y-2 text-sm text-gray-700">
                    <p><strong>{% trans "Campus" %} :</strong> <span id="review-campus"></span></p>
                    <p><strong>{% trans "Programme" %} :</strong> <span id="review-program"></span></p>
                    <p><strong>{% trans "Apprentissage" %} :</strong> <span id="review-apprenticeship"></span></p>
                </div>
            </div>

            <!-- Documents -->
            <div class="p-6 bg-gray-50 rounded-xl shadow-sm border md:col-span-2">
                <h4 class="text-lg font-semibold mb-4 text-gray-800 flex items-center">
                    <i class="fas fa-file-alt text-primary mr-2"></i> {% trans "Documents" %}
                </h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-700">
                    <p><strong>{% trans "CV" %} :</strong> <span id="review-cv"></span></p>
                    <p><strong>{% trans "Lettre de motivation" %} :</strong> <span id="review-lettre_motivation"></span></p>
                    <p><strong>{% trans "Relevés de notes / Attestation d'études" %} :</strong> <span id="review-releves_notes"></span></p>
                    <p><strong>{% trans "Pièce d'identité" %} :</strong> <span id="review-piece_identite"></span></p>
                    <p><strong>{% trans "Photo d'identité" %} :</strong> <span id="review-photo_identite"></span></p>
                    <p><strong>{% trans "Portfolio" %} :</strong> <span id="review-portfolio"></span></p>
                    <p><strong>{% trans "Signature" %} :</strong> <span id="review-signature"></span></p>
                </div>
            </div>

            <!-- Sources -->
            <div class="p-6 bg-gray-50 rounded-xl shadow-sm border">
                <h4 class="text-lg font-semibold mb-4 text-gray-800 flex items-center">
                    <i class="fas fa-bullhorn text-primary mr-2"></i> {% trans "Comment avez-vous entendu parler de nous ?" %}
                </h4>
                <p class="text-sm text-gray-700"><strong>{% trans "Sources" %} :</strong> <span id="review-how_heard"></span></p>
            </div>

            <!-- Déclaration -->
            <div class="p-6 bg-gray-50 rounded-xl shadow-sm border">
                <h4 class="text-lg font-semibold mb-4 text-gray-800 flex items-center">
                    <i class="fas fa-clipboard-check text-primary mr-2"></i> {% trans "Déclaration" %}
                </h4>
                <div class="space-y-2 text-sm text-gray-700">
                    <p><strong>{% trans "Acceptée" %} :</strong> <span id="review-declaration_accepted"></span></p>
                    <p><strong>{% trans "Fait à" %} :</strong> <span id="review-declaration_place"></span></p>
                    <p><strong>{% trans "Le" %} :</strong> <span id="review-declaration_date"></span></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Boutons de navigation -->
    <div class="flex justify-between mt-8">
        <button type="button" class="bg-gray-100 text-gray-700 font-medium py-3 px-8 rounded-lg shadow-sm hover:bg-gray-200 transition-colors prev-step">
            <i class="fas fa-arrow-left mr-2"></i> {% trans "Précédent" %}
        </button>
        <button type="submit" id="submit-btn" class="bg-primary-green text-white font-semibold py-3 px-8 rounded-lg shadow-md hover:bg-green-700 transition-colors">
            {% trans "Soumettre ma Candidature" %} <i class="fas fa-paper-plane ml-2"></i>
        </button>
    </div>
</div>


                </form>
            </section>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const loader = new SectionLoaderManager('admission-section', 'fill-primary-green', 0.3);
            const form = document.getElementById('admission-form');
            const submitBtn = document.getElementById('submit-btn');
            const steps = document.querySelectorAll('.wizard-step');
            const progressSteps = document.querySelectorAll('.progress-step');
            const nextButtons = document.querySelectorAll('.next-step');
            const prevButtons = document.querySelectorAll('.prev-step');
            let currentStep = 1;
            let isSubmitting = false;

            function updateProgress() {
                progressSteps.forEach(step => {
                    const stepNum = parseInt(step.dataset.step);
                    step.classList.remove('active', 'completed');
                    if (stepNum === currentStep) {
                        step.classList.add('active');
                    } else if (stepNum < currentStep) {
                        step.classList.add('completed');
                    }
                });
                steps.forEach(step => {
                    step.classList.remove('active');
                    if (parseInt(step.dataset.step) === currentStep) {
                        step.classList.add('active');
                    }
                });
            }

            function validateStep(step) {
                let isValid = true;
                const requiredFields = steps[step - 1].querySelectorAll('[required]');
                requiredFields.forEach(field => {
                    if (!field.value.trim()) {
                        field.classList.add('border-red-500');
                        const errorDiv = document.getElementById(`${field.name}-error`);
                        if (errorDiv) {
                            errorDiv.classList.remove('hidden');
                            errorDiv.textContent = '{% trans "This field is required." %}';
                        }
                        isValid = false;
                    } else {
                        field.classList.remove('border-red-500');
                        const errorDiv = document.getElementById(`${field.name}-error`);
                        if (errorDiv) {
                            errorDiv.classList.add('hidden');
                            errorDiv.textContent = '';
                        }
                    }
                });

                if (step === 4) {
                    const campus = document.querySelector('input[name="campus"]:checked');
                    if (!campus) {
                        const errorDiv = document.getElementById('campus-error');
                        errorDiv.classList.remove('hidden');
                        errorDiv.textContent = '{% trans "Please select a campus." %}';
                        isValid = false;
                    } else {
                        const errorDiv = document.getElementById('campus-error');
                        errorDiv.classList.add('hidden');
                        errorDiv.textContent = '';
                    }

                    const program = document.querySelector('input[name="program"]:checked');
                    if (!program) {
                        const errorDiv = document.getElementById('program-error');
                        errorDiv.classList.remove('hidden');
                        errorDiv.textContent = '{% trans "Please select a program." %}';
                        isValid = false;
                    } else {
                        const errorDiv = document.getElementById('program-error');
                        errorDiv.classList.add('hidden');
                        errorDiv.textContent = '';
                    }

                    const apprenticeship = document.querySelector('input[name="apprenticeship"]:checked');
                    if (!apprenticeship) {
                        const errorDiv = document.getElementById('apprenticeship-error');
                        errorDiv.classList.remove('hidden');
                        errorDiv.textContent = '{% trans "Please select an apprenticeship option." %}';
                        isValid = false;
                    } else {
                        const errorDiv = document.getElementById('apprenticeship-error');
                        errorDiv.classList.add('hidden');
                        errorDiv.textContent = '';
                    }
                }

                return isValid;
            }

            nextButtons.forEach(button => {
                button.addEventListener('click', () => {
                    if (validateStep(currentStep)) {
                        currentStep++;
                        if (currentStep === 6) {
                            updateReviewSection();
                        }
                        updateProgress();
                    } else {
                        window.toastManager.buildToast()
                            .setMessage('{% trans "Please fill in all required fields." %}')
                            .setType('danger')
                            .setPosition('top-right')
                            .setDuration(5000)
                            .show();
                    }
                });
            });

            prevButtons.forEach(button => {
                button.addEventListener('click', () => {
                    currentStep--;
                    updateProgress();
                });
            });

            function updateReviewSection() {
                document.getElementById('review-last_name').textContent = document.querySelector('input[name="last_name"]').value || '{% trans "Not provided" %}';
                document.getElementById('review-first_name').textContent = document.querySelector('input[name="first_name"]').value || '{% trans "Not provided" %}';
                document.getElementById('review-date_of_birth').textContent = document.querySelector('input[name="date_of_birth"]').value || '{% trans "Not provided" %}';
                document.getElementById('review-phone_number').textContent = document.querySelector('input[name="phone_number"]').value || '{% trans "Not provided" %}';
                document.getElementById('review-email').textContent = document.querySelector('input[name="email"]').value || '{% trans "Not provided" %}';
                document.getElementById('review-address').textContent = document.querySelector('input[name="address"]').value || '{% trans "Not provided" %}';
                document.getElementById('review-zip_code').textContent = document.querySelector('input[name="zip_code"]').value || '{% trans "Not provided" %}';
                document.getElementById('review-city').textContent = document.querySelector('input[name="city"]').value || '{% trans "Not provided" %}';
                document.getElementById('review-country').textContent = document.querySelector('input[name="country"]').value || '{% trans "Not provided" %}';
                document.getElementById('review-last_diploma').textContent = document.querySelector('input[name="last_diploma"]').value || '{% trans "Not provided" %}';
                document.getElementById('review-institution').textContent = document.querySelector('input[name="institution"]').value || '{% trans "Not provided" %}';
                document.getElementById('review-institution_city_country').textContent = document.querySelector('input[name="institution_city_country"]').value || '{% trans "Not provided" %}';
                document.getElementById('review-year_obtained').textContent = document.querySelector('input[name="year_obtained"]').value || '{% trans "Not provided" %}';
                document.getElementById('review-campus').textContent = document.querySelector('input[name="campus"]:checked')?.value || '{% trans "Not provided" %}';
                document.getElementById('review-program').textContent = document.querySelector('input[name="program"]:checked')?.value || '{% trans "Not provided" %}';
                document.getElementById('review-apprenticeship').textContent = document.querySelector('input[name="apprenticeship"]:checked')?.value || '{% trans "Not provided" %}';
                document.getElementById('review-cv').textContent = document.querySelector('input[name="cv"]').files[0]?.name || '{% trans "Not provided" %}';
                document.getElementById('review-lettre_motivation').textContent = document.querySelector('input[name="lettre_motivation"]').files[0]?.name || '{% trans "Not provided" %}';
                document.getElementById('review-releves_notes').textContent = document.querySelector('input[name="releves_notes"]').files[0]?.name || '{% trans "Not provided" %}';
                document.getElementById('review-piece_identite').textContent = document.querySelector('input[name="piece_identite"]').files[0]?.name || '{% trans "Not provided" %}';
                document.getElementById('review-photo_identite').textContent = document.querySelector('input[name="photo_identite"]').files[0]?.name || '{% trans "Not provided" %}';
                document.getElementById('review-portfolio').textContent = document.querySelector('input[name="portfolio"]').files[0]?.name || '{% trans "Not provided" %}';
                document.getElementById('review-signature').textContent = document.querySelector('input[name="signature"]').files[0]?.name || '{% trans "Not provided" %}';
                const howHeard = [];
                if (document.querySelector('input[name="how_heard_internet"]').checked) howHeard.push('Internet');
                if (document.querySelector('input[name="how_heard_social_media"]').checked) howHeard.push('Réseaux sociaux');
                if (document.querySelector('input[name="how_heard_forum_check"]').checked) {
                    const forum = document.querySelector('input[name="how_heard_forum"]').value;
                    howHeard.push(forum ? `Forum / Salon: ${forum}` : 'Forum / Salon');
                }
                if (document.querySelector('input[name="how_heard_student_alumni"]').checked) howHeard.push('Étudiant ou alumni');
                if (document.querySelector('input[name="how_heard_other_check"]').checked) {
                    const other = document.querySelector('input[name="how_heard_other"]').value;
                    howHeard.push(other ? `

Autre: ${other}` : 'Autre');
                }
                document.getElementById('review-how_heard').textContent = howHeard.length > 0 ? howHeard.join(', ') : '{% trans "Not provided" %}';
                document.getElementById('review-declaration_accepted').textContent = document.querySelector('input[name="declaration_accepted"]').checked ? '{% trans "Accepted" %}' : '{% trans "Not accepted" %}';
                document.getElementById('review-declaration_place').textContent = document.querySelector('input[name="declaration_place"]').value || '{% trans "Not provided" %}';
                document.getElementById('review-declaration_date').textContent = document.querySelector('input[name="declaration_date"]').value || '{% trans "Not provided" %}';
            }

            form.removeEventListener('submit', handleSubmit);
            form.addEventListener('submit', handleSubmit);

            function handleSubmit(e) {
                e.preventDefault();
                if (isSubmitting) return;

                isSubmitting = true;
                const formData = new FormData(form);
                submitBtn.disabled = true;
                loader.showLoader();

                fetch('{% url "admission:admission_ue" %}', {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-CSRFToken': formData.get('csrfmiddlewaretoken')
                    }
                })
                .then(response => response.json())
                .then(data => {
                    isSubmitting = false;
                    submitBtn.disabled = false;
                    loader.hideLoader();

                    if (data.success) {
                        window.toastManager.buildToast()
                            .setMessage(data.message)
                            .setType('success')
                            .setPosition('top-right')
                            .setDuration(5000)
                            .show();
                        form.reset();
                        currentStep = 1;
                        updateProgress();
                    } else {
                        window.toastManager.buildToast()
                            .setMessage(data.message)
                            .setType('danger')
                            .setPosition('top-right')
                            .setDuration(5000)
                            .show();
                    }
                })
                .catch(error => {
                    isSubmitting = false;
                    submitBtn.disabled = false;
                    loader.hideLoader();
                    window.toastManager.buildToast()
                        .setMessage('{% trans "An error occurred. Please try again." %}')
                        .setType('danger')
                        .setPosition('top-right')
                        .setDuration(5000)
                        .show();
                    console.error('Error:', error);
                });
            }
        });
    </script>
{% endblock %}